<!DOCTYPE html>
<html lang="es-ES" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
<title>La propiedad (lastIndex) al validar un campo con Regex</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://frontend-labs.com/xmlrpc.php">

<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-52967407-1', 'auto');
ga('require', 'displayfeatures');
ga('send', 'pageview');

</script>
<!-- End of Google Analytics -->


<!-- Push notifications for this website enabled by Roost. Support for Safari, Firefox, and Chrome Browser Push. (v 2.1.8) - http://goroost.com/ -->
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	
<!-- This site is optimized with the Yoast WordPress SEO plugin v1.6.3 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" />
<link rel="publisher" href="https://plus.google.com/u/0/115909218719662540839"/>
<meta property="og:locale" content="es_ES" />
<meta property="og:type" content="article" />
<meta property="og:title" content="La propiedad (lastIndex) al validar un campo con Regex" />
<meta property="og:description" content="Muchas veces hemos visto casos donde era necesario validar campos como correos electrónicos, números telefónicos o cualquier otro caso con expresiones regulares y no hemos tenido&hellip;" />
<meta property="og:url" content="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" />
<meta property="og:site_name" content="FrontEnd Labs" />
<meta property="article:publisher" content="https://www.facebook.com/frontendlabs.peru" />
<meta property="article:tag" content="Expresiones regulares" />
<meta property="article:tag" content="Javascript" />
<meta property="article:section" content="Javascript" />
<meta property="article:published_time" content="2014-04-21T17:09:44+00:00" />
<meta property="article:modified_time" content="2014-08-08T14:12:59+00:00" />
<meta property="og:updated_time" content="2014-08-08T14:12:59+00:00" />
<meta property="og:image" content="http://frontend-labs.com/wp-content/uploads/2014/04/regular.jpg" />
<meta property="og:image" content="http://frontend-labs.com/wp-content/uploads/2014/04/lasIndex1-300x220.jpg" />
<meta property="og:image" content="http://frontend-labs.com/wp-content/uploads/2014/04/explicacion.jpg" />
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="FrontEnd Labs &raquo; Feed" href="http://frontend-labs.com/feed" />
<link rel="alternate" type="application/rss+xml" title="FrontEnd Labs &raquo; RSS de los comentarios" href="http://frontend-labs.com/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="FrontEnd Labs &raquo; La misteriosa propiedad &#8220;lastIndex&#8221; al validar un campo con Regex RSS de los comentarios" href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex/feed" />
<link rel='stylesheet' id='font-awesome-css'  href='http://frontend-labs.com/wp-content/themes/ink/assets/css/font-awesome.css?ver=4.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='stag-shortcode-styles-css'  href='http://frontend-labs.com/wp-content/plugins/stagtools/assets/css/stag-shortcodes.css?ver=1.2.6' type='text/css' media='all' />
<link rel='stylesheet' id='main-style-css'  href='http://frontend-labs.com/wp-content/plugins/wens-social-links/css/main-style.css?ver=3.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='stag-google-fonts-css'  href='//fonts.googleapis.com/css?family=Roboto+Slab%3Aregular%2C700%7CMontserrat%3Aregular%2C700&#038;subset=latin%2Clatin&#038;ver=1.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='stag-style-css'  href='http://frontend-labs.com/wp-content/themes/ink/style.css?ver=1.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='http://frontend-labs.com/wp-content/plugins/jetpack/css/jetpack.css?ver=3.2.1' type='text/css' media='all' />
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/jetpack/modules/related-posts/related-posts.js?ver=20140611'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/wens-social-links/js/custom.js?ver=4.0'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/jetpack/_inc/spin.js?ver=1.3'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/jetpack/_inc/jquery.spin.js?ver=1.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://frontend-labs.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://frontend-labs.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.0" />
<link rel='shortlink' href='http://wp.me/p59rJv-2e' />
<!-- This site is powered by Tweet, Like, Plusone and Share Plugin - http://techxt.com/tweet-like-google-1-and-share-plugin-wordpress/ -->
		<meta property="og:type" content="article" />
		<meta property="og:title" content="La misteriosa propiedad &#8220;lastIndex&#8221; al validar un campo con Regex" />
		<meta property="og:url" content="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex"/>
		<meta property="og:site_name" content="FrontEnd Labs" />
		<meta property="og:description" content="Muchas veces hemos visto casos donde era necesario validar campos como correos electrónicos, números telefónicos o cualquier otro caso con expresiones regul"/>
		<!--[if lt IE 9]>
	  <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
					<meta property="og:image" content="http://frontend-labs.com/wp-content/uploads/2014/04/regular.jpg" />
			<style type="text/css">div.socialicons{float:left;display:block;margin-right: 10px;line-height: 1;}div.socialiconsv{line-height: 1;}div.socialicons p{margin-bottom: 0px !important;margin-top: 0px !important;padding-bottom: 0px !important;padding-top: 0px !important;}div.social4iv{background: none repeat scroll 0 0 #FFFFFF;border: 1px solid #aaa;border-radius: 3px 3px 3px 3px;box-shadow: 3px 3px 3px #DDDDDD;padding: 3px;position: fixed;text-align: center;top: 55px;width: 68px;display:none;}div.socialiconsv{padding-bottom: 5px;}</style>
<style type='text/css'>img#wpstats{display:none}</style><meta name="generator" content="Ink 1.2.1">
<meta name="generator" content="StagCustomizer 1.0">
	<style id="stag-custom-css" type="text/css">
		body,
		.site,
		hr:not(.stag-divider)::before {
			background-color: #ffffff;
		}
		body, .entry-subtitle {
			font-family: "Roboto Slab";
		}
		a,
		.archive-header__title span,
		.footer-menu a:hover {
			color: #f0ad2c;
		}
		h1, h2, h3, h4, h5, h6, .button, .stag-button, input[type="submit"], input[type="reset"], .button-secondary, legend, .rcp_subscription_level_name {
			font-family: "Montserrat";
		}
		.post-grid {
			border-color: #ffffff;
		}
			</style>
	<link rel='shortcut icon' href='http://frontend-labs.com/wp-content/uploads/2014/11/fav1.png' />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
						<style type="text/css" media="all">
				.custom-logo {
					background: url("http://frontend-labs.com/wp-content/uploads/2014/11/logofe.png") no-repeat;
					width: 62px;
					height: 60px;
					background-size: contain;
				}
			</style>
		<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>
<body class="single single-post postid-138 single-format-standard gecko header-over stagtools" data-layout="">


<nav class="site-nav" role="complementary">
	<div class="site-nav--scrollable-container">
		<i class="fa fa-times close-nav"></i>

		
					<aside id="search-3" class="site-nav__section widget_search"><form role="search" method="get" class="search-form" action="http://frontend-labs.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Buscar &hellip;" value="" name="s" title="Buscar por:">
	</label>
	<button type="submit" class="search-submit"><i class="fa fa-search"></i></button>
</form>
</aside><aside id="blog_subscription-2" class="site-nav__section jetpack_subscription_widget"><h4 class="widgettitle"><label for="subscribe-field">Suscríbete a nuestro blog!</label></h4>
		<form action="#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2">
			<p id="subscribe-text"></p>
			<p id="subscribe-email">
				<label id="jetpack-subscribe-label" for="email">
					Dirección de email				</label>
				<input type="email" name="email" value="" id="subscribe-field" placeholder="Dirección de email" />
			</p>

			<p id="subscribe-submit">
				<input type="hidden" name="action" value="subscribe" />
				<input type="hidden" name="source" value="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" />
				<input type="hidden" name="sub-type" value="widget" />
				<input type="hidden" name="redirect_fragment" value="blog_subscription-2" />
								<input type="submit" value="Suscribir" name="jetpack_subscriptions_widget" />
			</p>
		</form>

		<script>
			( function( d ) {
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.getElementById( 'jetpack-subscribe-label' );
 					label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
 					label.style.position = 'absolute';
 					label.style.height   = '1px';
 					label.style.width    = '1px';
 					label.style.overflow = 'hidden';
 						
				}
			} ) ( document );
		</script>

		
</aside><aside id="facebook-likebox-2" class="site-nav__section widget_facebook_likebox"><iframe src="http://www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Ffrontendlabs.peru&#038;width=270&#038;height=432&#038;colorscheme=light&#038;show_faces=true&#038;stream=false&#038;show_border=false&#038;header=false&#038;force_wall=false&#038;locale=es_ES" scrolling="no" frameborder="0" style="border: none; overflow: hidden; width: 270px;  height: 432px; background: #fff"></iframe></aside><aside id="twitter_timeline-2" class="site-nav__section widget_twitter_timeline"><h4 class="widgettitle">Síguenos en Twitter</h4><a class="twitter-timeline" data-widget-id="519172413922107392" data-theme="light" data-link-color="#f96e5b" data-border-color="#e8e8e8" data-tweet-limit="1" width="280" height="400" lang="ES">Mis tuits</a></aside>			</div>
</nav>
<div class="site-nav-overlay"></div>

<div id="page" class="hfeed site">

	<div id="content" class="site-content">

		<header id="masthead" class="site-header">

			<div class="site-branding">

									<a class="custom-logo" title="Frontend-Labs" href="http://frontend-labs.com/">
						<div class="bubbles">
						    <div class="bubble b1"></div>
						    <div class="bubble b2"></div>
						    <div class="bubble b3"></div>
						    <div class="bubble b4"></div>    
						</div>  
					</a>
				
				<p class="site-description"></p>
			</div>

			<a href="#" id="site-navigation-toggle" class="site-navigation-toggle"><i class="fa fa-navicon"></i></a>

			
		</header><!-- #masthead -->

<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

	
	<style type="text/css" scoped>
		
		.background-video { opacity: 0.4; }

				.article-cover__background { background-image: url(http://frontend-labs.com/wp-content/uploads/2014/04/regular.jpg); opacity: 0.4; }
		
			</style>

	
<div class="article-cover article-cover--138">
	<div class="article-cover__background stag-image--none"></div>

	
	<div class="article-cover__inner">
		<div class="article-cover__content">
			<h1 class="entry-title">
				<a href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" rel="bookmark">
					La misteriosa propiedad &#8220;lastIndex&#8221; al validar un campo con Regex
									</a>
			</h1>


			<footer class="entry-meta">
				<span class="posted-on"><a href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" title="5:09 pm" rel="bookmark"><time class="entry-date published" datetime="2014-04-21T17:09:44+00:00">21 abril, 2014</time><time class="updated" datetime="2014-08-08T14:12:59+00:00">8 agosto, 2014</time></a></span><span class="reading-time hide">3 minutos</span><span class="byline">por <span class="author vcard"><a class="url fn n" href="http://frontend-labs.com/author/victorjsv">Victor Sandoval Valladolid</a></span></span>											</footer>

					</div>
	</div>

	
	<span id="scroll-to-content" class="article-cover__arrow">
		<i class="fa fa-chevron-down"></i>
	</span>

</div>

	<main id="main" class="site-main">

		
		
<article id="post-138" class="post-138 post type-post status-publish format-standard has-post-thumbnail hentry category-javascript tag-expresiones-regulares-2 tag-javascript">

	<div class="entry-content">
		<p>Muchas veces hemos visto casos donde era necesario validar campos como correos electrónicos, números telefónicos o cualquier otro caso con expresiones regulares y no hemos tenido ningún problema en su correcto funcionamiento, pero aveces suceden casos extraños donde es necesario revisar más a fondo el flujo de la validación.</p>
<p>Primero debemos entender lo que significa el <strong>lastIndex</strong> en una <strong>expresión regular</strong>.</p>
<p>Esta propiedad solo se asocia a los objetos <strong>RegExp</strong> (Expresión regular) &#8211; &#8220;global&#8221;.<br />
Para entender mejor el significado de &#8220;global&#8221;,  lo explicaremos con el siguiente ejemplo.</p>
<p>En una expresión regular existen las banderas o flags que modifican el comportamiento de la búsqueda.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var str = '_x_x'; //Definimos una cadena

// Caso 1:
var regex1 = /x/; //Definimos la expresión regular
console.log(str.match(regex1));
//En consola saldrá: x
//Encontró una coincidencia

//Caso 2:
var regex2 = /x/g; //Definimos la expresión regular con una bandera &quot;g&quot; que significa &quot;global&quot;.
console.log(str.match(regex2));
//En consola saldrá: x,x
//Encontró 2 coincidencias
</pre>
<p>Como vemos en el CASO 2, al tener una expresión regular con la bandera &#8220;g&#8221; significa que en un contexto global va a buscar todas las coincidencias &#8220;x&#8221; que encuentre en la cadena, a diferencia del CASO 1 donde solo busca la primera coincidencia y no sigue buscando.</p>
<h2>LastIndex:</h2>
<p>La propiedad lastIndex es un número que cambia cada vez que se produce una coincidencia correcta.<br />
Los métodos test del objeto RegExp, y los métodos match, replace y split del objeto String modifican la propiedad lastIndex.</p>
<p>Tenemos el siguiente código, donde observamos que al aplicar el método &#8220;test&#8221; varias veces el &#8220;lastindex&#8221; se va modificando.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var str = '_x_x';
var regex = /x/g;
console.log(regex.lastIndex) //0
regex.test(str)
console.log(regex.lastIndex) //2
regex.test(str)
console.log(regex.lastIndex) //4
</pre>
<p>La posición del lastIndex es referente a la posición donde se encontró la coincidencia.</p>
<p><a href="http://frontend-labs.com/wp-content/uploads/2014/04/lasIndex1.jpg"><img class="alignnone size-medium wp-image-449" alt="lasIndex" src="http://frontend-labs.com/wp-content/uploads/2014/04/lasIndex1-300x220.jpg" width="300" height="220" /></a></p>
<p>Con el siguiente ejemplo podemos ver cómo se comporta el lastIndex cuando se realiza una validación por el método test():</p>
<h3>HTML:</h3>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;button type=&quot;click&quot; id=&quot;btnTest&quot;&gt;Test&lt;/button&gt;
&lt;p&gt;Cadena: _x_x&lt;/p&gt;
&lt;p&gt;lastIndex: &lt;span&gt;&lt;/span&gt;&lt;/p&gt;
</pre>
<h3>JavaScript:</h3>
<pre class="brush: jscript; title: ; notranslate" title="">
var regex = /x/g,
    str = '_x_x';

$(&quot;span&quot;).text(regex.lastIndex) //0
$('#btnTest').on('click', function(){
  regex.test(str);
  $(&quot;span&quot;).text(regex.lastIndex);
  /*
  - Al primer click
  //1
  - Al segundo click
  //2
  - Al tercer click
  //4
  - Al cuarto click
  //0
  //...
*/
});
</pre>
<h3>Ejemplo en vivo:</h3>
<p><iframe width="100%" height="300" src="http://jsfiddle.net/LRwYZ/3/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></p>
<p>Como vemos el lastIndex por defecto comienza en &#8220;0&#8221; y cada vez que hacemos clic, se va actualizando hasta llegar a &#8220;4&#8221; y al no encontrar otra siguiente coincidencia se reinicia a &#8220;0&#8221;.</p>
<p>En algunos casos vamos a encontrar con situaciones donde el &#8220;lastIndex&#8221; va a cumplir un rol muy importante a la hora de hacer validaciones por expresiones regulares, como por ejemplo la validación de un correo.</p>
<h3>HTML:</h3>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;input id=&quot;txtMail&quot; type=&quot;text&quot; value=&quot;mi_correo@frontend.pe&quot;&gt;
&lt;button type=&quot;click&quot; id=&quot;btnValidate&quot;&gt;Validar!&lt;/button&gt;
&lt;p&gt;LastIndex: &lt;span id=&quot;spanIndex&quot;&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p id=&quot;pMessage&quot;&gt;&lt;/p&gt;
</pre>
<h3>JavaScript:</h3>
<pre class="brush: jscript; title: ; notranslate" title="">
var spanIndex = $(&quot;#spanIndex&quot;),
	message = $(&quot;#pMessage&quot;),
	txtMail = $(&quot;#txtMail&quot;),
	regex = /^[\w-\.]+@[\w-]+(\.[A-Za-z_-]{2,4}){1,3}$/g;

spanIndex.text(regex.lastIndex);
$('#btnValidate').on('click', function(){
	var value = txtMail.val(),
            valueText;

	if(regex.test(value)){
	    valueText = 'SI';
	}else{
            valueText = 'NO';
	}
        message.show().text(valueText).fadeOut();
	spanIndex.text(regex.lastIndex);
});
</pre>
<h3>Ejemplo en vivo:</h3>
<p><iframe width="100%" height="300" src="http://jsfiddle.net/K7w4U/4/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></p>
<p>En el ejemplo anterior, el correo siempre es válido, pero<br />
<strong>¿porqué muestra algunas veces que no lo es?</strong>. Esto se debe al lastIndex.</p>
<h2>Explicación: </h2>
<p>Después que se declara una expresión regular y se almacena en una variable con la propiedad lastIndex, este va a tomar por defecto el valor de 0.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var regex = /^[\w-\.]+@[\w-]+(\.[A-Za-z_-]{2,4}){1,3}$/g;
console.log(regex.lastIndex); //0
</pre>
<p>En primer lugar notamos que el lastIndex por defecto está en &#8220;0&#8221; y al hacer el <strong>1er click</strong>, valida correctamente mostrando que el <strong>correo sí es válido</strong>, pero notamos que el lastIndex se modificó a 21 (que es la posición donde lo encontró).</p>
<p>En segundo lugar notamos que lastIndex tiene el valor de 21 y al hacer el 2do click, notamos que vuelve a &#8220;0&#8221;, pero <strong>muestra que el correo no es válido</strong>.</p>
<p>Esto sucede debido a que el lastIndex (en el segundo click) tiene el valor de 21 y va a buscar a partir de esa posición la siguiente coincidencia, pero al estar en la última posición de la cadena va a volver a &#8220;0&#8221;, <strong>mostrando que el correo no es válido.</strong></p>
<p><a href="http://frontend-labs.com/wp-content/uploads/2014/04/explicacion.jpg"><img src="http://frontend-labs.com/wp-content/uploads/2014/04/explicacion.jpg" alt="explicacion" width="862" height="500" class="alignnone size-full wp-image-555" /></a></p>
<p>Para poder solucionar este problema y que siempre se muestre válido, hay que <strong>volver a asignar el valor del lastindex a &#8220;0&#8221;</strong> dentro de la función click.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
regex.lastIndex = 0; //Aqui donde le volvemos a asignar el valor &quot;0&quot;
</pre>
<p>El código quedaría de la siguiente forma.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var spanIndex = $(&quot;#spanIndex&quot;),
    message = $(&quot;#pMessage&quot;),
    txtMail = $(&quot;#txtMail&quot;),
    regex = /^[\w-\.]+@[\w-]+(\.[A-Za-z_-]{2,4}){1,3}$/g;

spanIndex.text(regex.lastIndex);
$('#btnValidate').on('click', function(){
	var value = txtMail.val(),
            valueText;

	regex.lastIndex = 0; //Aqui donde le volvemos a asignar el valor &quot;0&quot;
	if(regex.test(value)){
	    valueText = 'SI';
	}else{
	    valueText = 'NO';
	}
        message.show().text(valueText).fadeOut();
	spanIndex.text(regex.lastIndex);
});
</pre>
<h3>Ejemplo en vivo:</h3>
<p><iframe width="100%" height="300" src="http://jsfiddle.net/K7w4U/5/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></p>
<p>De esta manera solucionamos el problema de la validación por expresión regular manipulando el lastIndex. Hay que observar que la declaración de la expresión regular es almacenada en la variable <strong>&#8220;regex&#8221;</strong> que está fuera de la función.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var regex = /^[\w-\.]+@[\w-]+(\.[A-Za-z_-]{2,4}){1,3}$/g;
</pre>
<p>Si la variable <strong>&#8220;regex&#8221;</strong> hubiese estado dentro de la función click, ya no era necesario igualar a &#8220;0&#8221; porque cada vez que se ejecuta la función &#8220;click&#8221;, se volverá a declarar la variable regex por ende su lastIndex es &#8220;0&#8221;.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var spanIndex = $(&quot;#spanIndex&quot;),
    message = $(&quot;#pMessage span&quot;),
    txtMail = $(&quot;#txtMail&quot;);

$('#btnValidate').on('click', function(){
   // La variable regex está dentro de la función
   var value = txtMail.val(),
       regex = /^[\w-\.]+@[\w-]+(\.[A-Za-z_-]{2,4}){1,3}$/g,
       valueText;
   //regex.lastIndex = 0; // Ya no es necesario.
   if(regex.test(value)){
      valueText = 'SI'
   }else{
      valueText = 'NO'
   }
   message.show().text(valueText).fadeOut();
   spanIndex.text(regex.lastIndex);
});
</pre>
<h3>Ejemplo en vivo:</h3>
<p><iframe width="100%" height="300" src="http://jsfiddle.net/K7w4U/6/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></p>
<p>Para aprender sobre expresiones regulares, puedes visitar este <a href="http://frontend-labs.com/1621--aprender-expresiones-regulares-en-espanol-videotutorial-parte-1" title="Aprender expresiones regulares" target="_blank">link</a> donde explica cómo entenderlos.</p>
<div class="social4i" style="height:29px;">
<div class="social4in" style="height:29px;float: left;">
<div class="socialicons s4twitter" style="float:left;margin-right: 10px;"><a href="https://twitter.com/share" data-url="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" data-counturl="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" data-text="La misteriosa propiedad &#8220;lastIndex&#8221; al validar un campo con Regex" class="twitter-share-button" data-count="horizontal" data-via="frontendlabs"></a></div>
<div class="socialicons s4fblike" style="float:left;margin-right: 10px;">
<div class="fb-like" data-href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" data-send="false"  data-layout="button_count" data-width="100" data-height="21"  data-show-faces="false"></div>
</div>
<div class="socialicons s4plusone" style="float:left;margin-right: 10px;">
<div class="g-plusone" data-size="medium" data-href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex"></div>
</div>
<div class="socialicons s4fbshare" style="position: relative;float:left;margin-right: 10px;">
<div class="s4ifbshare" >
<div class="fb-share-button" data-href="http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex" data-width="450" data-type="button_count"></div>
</div>
</div>
</div>
<div style="clear:both"></div>
</div>

<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Relacionado</em></h3>
</div>	</div><!-- .entry-content -->


		<footer class="entry-footer">
		<div class="grid">

			<div class="unit one-of-two">
				Tags: <a href="http://frontend-labs.com/tag/expresiones-regulares-2" rel="tag">Expresiones regulares</a>, <a href="http://frontend-labs.com/tag/javascript" rel="tag">Javascript</a> / Category: <a href="http://frontend-labs.com/category/javascript" rel="category tag">Javascript</a>
							</div>

						<div class="unit one-of-two">
				
<div class="post-share-buttons">
	<h5>Share on</h5>

		<a target="_blank" class="button" href="http://www.twitter.com?status=La+misteriosa+propiedad+%26%238220%3BlastIndex%26%238221%3B+al+validar+un+campo+con+Regex+on+FrontEnd+Labs+http%3A%2F%2Ffrontend-labs.com%2F138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex">Twitter</a>
	<a target="_blank" class="button" href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Ffrontend-labs.com%2F138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex">Facebook</a>
	</div>
			</div>
					</div>
	</footer><!-- .entry-meta -->
	
</article><!-- #post-## -->

		
		
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-24">
        <div id="dsq-comment-header-24" class="dsq-comment-header">
            <cite id="dsq-cite-24">
                <span id="dsq-author-user-24">Jan Sanchez</span>
            </cite>
        </div>
        <div id="dsq-comment-body-24" class="dsq-comment-body">
            <div id="dsq-comment-message-24" class="dsq-comment-message"><p>Gracias Victor, hoy tuve ese problema con Regex y lo pude resolver gracias a tu post.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-26">
        <div id="dsq-comment-header-26" class="dsq-comment-header">
            <cite id="dsq-cite-26">
                <span id="dsq-author-user-26">Brayan Borda Pacheco</span>
            </cite>
        </div>
        <div id="dsq-comment-body-26" class="dsq-comment-body">
            <div id="dsq-comment-message-26" class="dsq-comment-message"><p>Manya que chvr, gracias Victor, tuve ese problema también cuando estaba haciendo un plugin y tuve que usar el objeto RegExp para generar una instancia de la expresión regular a cada momento para evitarme ello, pero no era lo mas óptimo. Con el lastIndex se soluciona como se debe. Gracias (Y)</p>
</div>
        </div>

    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
var disqus_url = 'http://frontend-labs.com/138--la-misteriosa-propiedad-lastindex-al-validar-un-campo-con-regex';
var disqus_identifier = '138 http://frontend-labs.com/?p=138';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'frontendlabs';
var disqus_title = "La misteriosa propiedad &#8220;lastIndex&#8221; al validar un campo con Regex";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=138';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


	
	</main><!-- #main -->

		<footer id="colophon" class="site-footer" role="contentinfo">
						<div class="footer-widgets-container">
				<div class="inside">
					<div class="footer-widgets grid">
								<aside id="recent-posts-2" class="widget unit one-of-two widget_recent_entries">		<h3 class="widgettitle">Entradas recientes</h3>		<ul>
					<li>
				<a href="http://frontend-labs.com/2085--capturas-de-pantalla-web-completa-pageres">Capturas de pantalla web automatizadas y en todos los tamaños con Pageres</a>
						</li>
					<li>
				<a href="http://frontend-labs.com/2052--tip-ignorar-un-archivo-en-git-ya-commiteado">Tip: Ignorar un archivo en git que ya ha sido commiteado antes</a>
						</li>
					<li>
				<a href="http://frontend-labs.com/1956--open-graph-protocol">¿Qué es el Open Graph Protocol?</a>
						</li>
					<li>
				<a href="http://frontend-labs.com/2005--git-tag-como-quitar-eliminar-tag-git">Git tag: ¿Cómo quitar o eliminar un tag desde un repositorio Git?</a>
						</li>
					<li>
				<a href="http://frontend-labs.com/1878--reparar-el-flash-player-de-google-chrome-en-debian">Reparar plugin flash player de Google Chrome en debian</a>
						</li>
				</ul>
		</aside><aside id="search-2" class="widget unit one-of-two widget_search"><form role="search" method="get" class="search-form" action="http://frontend-labs.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Buscar &hellip;" value="" name="s" title="Buscar por:">
	</label>
	<button type="submit" class="search-submit"><i class="fa fa-search"></i></button>
</form>
</aside><aside id="recent-comments-2" class="widget unit one-of-two widget_recent_comments"><h3 class="widgettitle">Comentarios recientes</h3><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">erikfloresq</span> en <a href="http://frontend-labs.com/2085--capturas-de-pantalla-web-completa-pageres#comment-96">Capturas de pantalla web automatizadas y en todos los tamaños con Pageres</a></li><li class="recentcomments"><span class="comment-author-link">Roberto</span> en <a href="http://frontend-labs.com/146--grunt-js-espanol-tutorial-basico-primeros-pasos#comment-95">Grunt.js en español &#8211; tutorial básico y primeros pasos</a></li><li class="recentcomments"><span class="comment-author-link">Carlos</span> en <a href="http://frontend-labs.com/887--pruebas-funcionales-con-python-y-selenium#comment-94">Selenium para las Pruebas Funcionales con Python</a></li><li class="recentcomments"><span class="comment-author-link">aridiodesign</span> en <a href="http://frontend-labs.com/1669--gulp-js-en-espanol-tutorial-basico-primeros-pasos-y-ejemplos#comment-93">Gulp.js en español &#8211; tutorial básico y primeros pasos</a></li><li class="recentcomments"><span class="comment-author-link">Frontend Labs</span> en <a href="http://frontend-labs.com/1669--gulp-js-en-espanol-tutorial-basico-primeros-pasos-y-ejemplos#comment-92">Gulp.js en español &#8211; tutorial básico y primeros pasos</a></li></ul></aside><aside id="categories-2" class="widget unit one-of-two widget_categories"><h3 class="widgettitle">Categorías</h3>		<ul>
	<li class="cat-item cat-item-35"><a href="http://frontend-labs.com/category/automatizacion" >Automatización</a>
</li>
	<li class="cat-item cat-item-33"><a href="http://frontend-labs.com/category/codigo" >Código</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://frontend-labs.com/category/css" title="CSS u hojas de estilo en cascada (en inglés Cascading Style Sheets) es un lenguaje usado para definir la presentación de un documento estructurado escrito en HTML. El W3C (World Wide Web Consortium) es el encargado de formular la especificación de las hojas de estilo que servirán de estándar para los agentes de usuario o navegadores.">Css</a>
</li>
	<li class="cat-item cat-item-38"><a href="http://frontend-labs.com/category/desarrollo-de-juegos" >desarrollo de juegos</a>
</li>
	<li class="cat-item cat-item-27"><a href="http://frontend-labs.com/category/diseno" title="Diseño">Diseño</a>
</li>
	<li class="cat-item cat-item-43"><a href="http://frontend-labs.com/category/git" title="Git es un software de control de versiones diseñado por Linus Torvalds, pensando en la eficiencia y la confiabilidad del mantenimiento de versiones de aplicaciones cuando estas tienen un gran número de archivos de código fuente.">Git</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://frontend-labs.com/category/html" title="HTML, siglas de HyperText Markup Language (lenguaje de marcas de hipertexto), hace referencia al lenguaje de marcado para la elaboración de páginas web. Es un estándar que sirve de referencia para la elaboración de páginas web en sus diferentes versiones, define una estructura básica y un código (denominado código HTML) para la definición de contenido de una página web, como texto, imágenes, etc. Es un estándar a cargo de la W3C, organización dedicada a la estandarización de casi todas las tecnologías ligadas a la web, sobre todo en lo referente a su escritura e interpretación. Es el lenguaje con el que se definen las páginas web.">Html</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://frontend-labs.com/category/inspiracion" >Inspiracion</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://frontend-labs.com/category/javascript" title="JavaScript es un lenguaje de programación interpretado, dialecto del estándar ECMAScript. Se define como orientado a objetos, basado en prototipos, imperativo, débilmente tipado y dinámico.

Se utiliza principalmente en su forma del lado del cliente (client-side), implementado como parte de un navegador web permitiendo mejoras en la interfaz de usuario y páginas web dinámicas aunque existe una forma de JavaScript del lado del servidor (Server-side JavaScript).">Javascript</a>
</li>
	<li class="cat-item cat-item-37"><a href="http://frontend-labs.com/category/linux" title="GNU/Linux es uno de los términos empleados para referirse a la combinación del núcleo o kernel libre similar a Unix denominado Linux con el sistema GNU. Su desarrollo es uno de los ejemplos más prominentes de software libre; todo su código fuente puede ser utilizado, modificado y redistribuido libremente por cualquiera bajo los términos de la GPL (Licencia Pública General de GNU, en inglés: General Public License) y otra serie de licencias libres.">Linux</a>
</li>
	<li class="cat-item cat-item-25"><a href="http://frontend-labs.com/category/mobile" title="Tecnología movil">Mobile</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://frontend-labs.com/category/preprocesadores" title="Son pseudo-lenguajes de programación que agregan muchas funcionalidades que no existen en un lenguaje de programación especifico.">Preprocesadores</a>
</li>
	<li class="cat-item cat-item-46"><a href="http://frontend-labs.com/category/codigo/python-2" title="Lenguaje de programación creado por guido vam rossum">Python</a>
</li>
	<li class="cat-item cat-item-32"><a href="http://frontend-labs.com/category/reflexion" title="Veamos como va cambiando la web">Reflexión</a>
</li>
	<li class="cat-item cat-item-45"><a href="http://frontend-labs.com/category/seo" >SEO</a>
</li>
	<li class="cat-item cat-item-47"><a href="http://frontend-labs.com/category/tutorial" >tutorial</a>
</li>
	<li class="cat-item cat-item-57"><a href="http://frontend-labs.com/category/vim" >Vim</a>
</li>
		</ul>
</aside>					</div>
				</div>
			</div><!-- .site-footer -->
			
									<div class="copyright">
				<div class="inside">

					<div class="grid">
						<div class="unit one-of-two site-info">
							Copyright © 2014 — Frontend Labs.
													</div><!-- .site-info -->

											</div>

				</div>
			</div><!-- .copyright -->
					</footer><!-- #colophon -->

	</div><!-- #content -->

</div><!-- #page -->

        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'frontendlabs';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('rel'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
                <script>var _roost = _roost || [];</script><noscript>Please enable JavaScript to use web push. Still not working? <a href="https://goroost.com/site-contact?noscript&amp;appkey=6e8ff35987f74c8c87cc592105dc6250" target="_blank">Troubleshoot web push notification registration with Roost.</a></noscript><script src="//cdn.goroost.com/roostjs/6e8ff35987f74c8c87cc592105dc6250" async></script>
    	<div style="display:none">
	</div>
		<script type="text/javascript">
			!function(d,s,id){
				var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';
				if(!d.getElementById(id)){
					js=d.createElement(s);
					js.id=id;js.src=p+"://platform.twitter.com/widgets.js";
					fjs.parentNode.insertBefore(js,fjs);
				}
			}(document,"script","twitter-wjs");
		</script>
		<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.9'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://frontend-labs.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://frontend-labs.com/wp-content/plugins/syntaxhighlighter-evolved-spacegray/shThemeSpacegray.css?ver=3.0.9";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.widget.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.accordion.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.tabs.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/stagtools/assets/js/stag-shortcode-scripts.js?ver=1.2.6'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.position.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/jquery/ui/jquery.ui.tooltip.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201448'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2014Novaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var StagFitvidsCustomSelectors = {"customSelector":"iframe[src*='www.viddler.com'],iframe[src*='money.cnn.com'],iframe[src*='www.educreations.com'],iframe[src*='\/\/blip.tv'],iframe[src*='\/\/embed.ted.com'],iframe[src*='\/\/www.hulu.com']"};
var postSettings = {"ajaxurl":"http:\/\/frontend-labs.com\/wp-admin\/admin-ajax.php","nonce":"6497d4df87","category":"","search":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/themes/ink/assets/js/jquery.custom.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/themes/ink/assets/js/plugins.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-content/themes/ink/assets/js/lib/fitvids/jquery.fitvids.min.js?ver=1.1.1'></script>
<script type='text/javascript' src='http://frontend-labs.com/wp-includes/js/comment-reply.min.js?ver=4.0'></script>
	<div id="fb-root"></div>
	<script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" src="//connect.facebook.net/es_LA/all.js#xfbml=1"></script><script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" src="https://platform.linkedin.com/in.js"></script>
	<script src="http://stats.wp.com/e-201448.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:3.2.1',blog:'76133241',post:'138',tz:'-5'});
	var load_cmc = function(){linktracker_init(76133241,138,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script></body>
</html>

<!-- Dynamic page generated in 1.179 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2014-11-23 20:10:42 -->

<!-- Compression = gzip -->
<!-- super cache -->